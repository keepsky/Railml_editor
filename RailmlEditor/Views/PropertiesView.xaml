<UserControl x:Class="RailmlEditor.Views.PropertiesView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:RailmlEditor"
    xmlns:viewmodels="clr-namespace:RailmlEditor.ViewModels"
    xmlns:utils="clr-namespace:RailmlEditor.Utils" mc:Ignorable="d" d:DesignHeight="600" d:DesignWidth="300">
    <UserControl.Resources>
        <!-- Property Styles for Table Grid -->
        <Style TargetType="Border" x:Key="PropLabelBorder">
            <Setter Property="Background" Value="#F0F0F0"/>
            <Setter Property="BorderBrush" Value="#C0C0C0"/>
            <Setter Property="BorderThickness" Value="0,0,1,1"/>
            <Setter Property="Padding" Value="5,3"/>
            <Setter Property="VerticalAlignment" Value="Stretch"/>
        </Style>

        <Style TargetType="Border" x:Key="PropValueBorder">
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="#C0C0C0"/>
            <Setter Property="BorderThickness" Value="0,0,0,1"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="VerticalAlignment" Value="Stretch"/>
        </Style>

        <Style TargetType="Border" x:Key="PropValueBorderWithRight" BasedOn="{StaticResource PropValueBorder}">
            <Setter Property="BorderThickness" Value="0,0,1,1"/>
        </Style>

        <Style TargetType="TextBlock" x:Key="PropLabelText">
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="Foreground" Value="#333"/>
        </Style>

        <Style TargetType="TextBox" x:Key="PropInput">
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="5,3"/>
            <Setter Property="Background" Value="Transparent"/>
        </Style>

        <Style TargetType="ComboBox" x:Key="PropComboInput">
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="5,3"/>
            <Setter Property="Margin" Value="0"/>
            <Setter Property="Background" Value="Transparent"/>
        </Style>

        <!-- Bulk Edit Properties -->
        <DataTemplate DataType="{x:Type viewmodels:BulkEditViewModel}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" SharedSizeGroup="Label"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <Border Grid.Row="0" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                    <TextBlock Text="Selection" Style="{StaticResource PropLabelText}"/>
                </Border>
                <Border Grid.Row="0" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                    <TextBlock Text="{Binding DisplayName}" FontWeight="Bold" VerticalAlignment="Center" Margin="5,0,0,0"/>
                </Border>

                <Border Grid.Row="1" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                    <TextBlock Text="Name" Style="{StaticResource PropLabelText}"/>
                </Border>
                <Border Grid.Row="1" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                    <TextBox Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource PropInput}"/>
                </Border>

                <Border Grid.Row="2" Grid.Column="0" Style="{StaticResource PropLabelBorder}" Visibility="{Binding HasTracks, Converter={StaticResource BoolToVis}}">
                    <TextBlock Text="Description" Style="{StaticResource PropLabelText}"/>
                </Border>
                <Border Grid.Row="2" Grid.Column="1" Style="{StaticResource PropValueBorder}" Visibility="{Binding HasTracks, Converter={StaticResource BoolToVis}}">
                    <TextBox Text="{Binding Description, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource PropInput}"/>
                </Border>

                <Border Grid.Row="3" Grid.Column="0" Style="{StaticResource PropLabelBorder}" Visibility="{Binding HasTracks, Converter={StaticResource BoolToVis}}">
                    <TextBlock Text="Type" Style="{StaticResource PropLabelText}"/>
                </Border>
                <Border Grid.Row="3" Grid.Column="1" Style="{StaticResource PropValueBorder}" Visibility="{Binding HasTracks, Converter={StaticResource BoolToVis}}">
                    <ComboBox ItemsSource="{Binding AvailableTypes}" SelectedItem="{Binding Type}" Style="{StaticResource PropComboInput}"/>
                </Border>

                <Border Grid.Row="4" Grid.Column="0" Style="{StaticResource PropLabelBorder}" Visibility="{Binding HasTracks, Converter={StaticResource BoolToVis}}">
                    <TextBlock Text="MainDir" Style="{StaticResource PropLabelText}"/>
                </Border>
                <Border Grid.Row="4" Grid.Column="1" Style="{StaticResource PropValueBorder}" Visibility="{Binding HasTracks, Converter={StaticResource BoolToVis}}">
                    <ComboBox ItemsSource="{Binding AvailableMainDirs}" SelectedItem="{Binding MainDir}" Style="{StaticResource PropComboInput}"/>
                </Border>

                <Border Grid.Row="5" Grid.Column="0" Style="{StaticResource PropLabelBorder}" Visibility="{Binding HasSignals, Converter={StaticResource BoolToVis}}">
                    <TextBlock Text="Signal Type" Style="{StaticResource PropLabelText}"/>
                </Border>
                <Border Grid.Row="5" Grid.Column="1" Style="{StaticResource PropValueBorder}" Visibility="{Binding HasSignals, Converter={StaticResource BoolToVis}}">
                    <ComboBox ItemsSource="{Binding SignalTypes}" SelectedItem="{Binding SignalType}" Style="{StaticResource PropComboInput}"/>
                </Border>

                <Border Grid.Row="6" Grid.Column="0" Style="{StaticResource PropLabelBorder}" Visibility="{Binding HasSignals, Converter={StaticResource BoolToVis}}">
                    <TextBlock Text="Function" Style="{StaticResource PropLabelText}"/>
                </Border>
                <Border Grid.Row="6" Grid.Column="1" Style="{StaticResource PropValueBorder}" Visibility="{Binding HasSignals, Converter={StaticResource BoolToVis}}">
                    <ComboBox ItemsSource="{Binding SignalFunctions}" SelectedItem="{Binding SignalFunction}" Style="{StaticResource PropComboInput}"/>
                </Border>

                <Border Grid.Row="7" Grid.Column="0" Style="{StaticResource PropLabelBorder}" Visibility="{Binding HasSignals, Converter={StaticResource BoolToVis}}">
                    <TextBlock Text="Direction" Style="{StaticResource PropLabelText}"/>
                </Border>
                <Border Grid.Row="7" Grid.Column="1" Style="{StaticResource PropValueBorder}" Visibility="{Binding HasSignals, Converter={StaticResource BoolToVis}}">
                    <ComboBox ItemsSource="{Binding Directions}" SelectedItem="{Binding Direction}" Style="{StaticResource PropComboInput}"/>
                </Border>
            </Grid>
        </DataTemplate>

        <DataTemplate DataType="{x:Type viewmodels:TrackNodeViewModel}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" SharedSizeGroup="Label"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <Border Grid.Row="0" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                    <TextBlock Text="Type" Style="{StaticResource PropLabelText}"/>
                </Border>
                <Border Grid.Row="0" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                    <ContentControl HorizontalAlignment="Stretch">
                        <ContentControl.Style>
                            <Style TargetType="ContentControl">
                                <Setter Property="Content">
                                    <Setter.Value>
                                        <ComboBox ItemsSource="{Binding AvailableNodeTypes}" SelectedItem="{Binding NodeType, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource PropComboInput}"/>
                                    </Setter.Value>
                                </Setter>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding NodeType}" Value="Connection">
                                        <Setter Property="Content">
                                            <Setter.Value>
                                                <TextBox Text="Connection" IsReadOnly="True" Foreground="Gray" Style="{StaticResource PropInput}"/>
                                            </Setter.Value>
                                        </Setter>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </ContentControl.Style>
                    </ContentControl>
                </Border>

                <Border Grid.Row="1" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                    <TextBlock Text="Node ID" Style="{StaticResource PropLabelText}"/>
                </Border>
                <Border Grid.Row="1" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                    <TextBox Text="{Binding Id}" IsReadOnly="True" Style="{StaticResource PropInput}" Foreground="Gray"/>
                </Border>

                <Border Grid.Row="2" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                    <TextBlock Text="Name" Style="{StaticResource PropLabelText}"/>
                </Border>
                <Border Grid.Row="2" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                    <TextBox Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource PropInput}"/>
                </Border>

                <Border Grid.Row="3" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                    <TextBlock Text="Code" Style="{StaticResource PropLabelText}"/>
                </Border>
                <Border Grid.Row="3" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                    <TextBox Text="{Binding Code, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource PropInput}"/>
                </Border>

                <Border Grid.Row="4" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                    <TextBlock Text="Pos" Style="{StaticResource PropLabelText}"/>
                </Border>
                <Border Grid.Row="4" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                    <TextBox Text="{Binding Pos, StringFormat=F0}" IsReadOnly="True" Style="{StaticResource PropInput}" Foreground="Gray"/>
                </Border>

                <Border Grid.Row="5" Grid.Column="0" Style="{StaticResource PropLabelBorder}" Visibility="{Binding NodeType, Converter={StaticResource ConnectionToVis}, ConverterParameter=Connection}">
                    <TextBlock Text="Connection ID" Style="{StaticResource PropLabelText}"/>
                </Border>
                <Border Grid.Row="5" Grid.Column="1" Style="{StaticResource PropValueBorder}" Visibility="{Binding NodeType, Converter={StaticResource ConnectionToVis}, ConverterParameter=Connection}">
                    <TextBox Text="{Binding ConnectionId}" IsReadOnly="True" Style="{StaticResource PropInput}" Background="#FFFFE0"/>
                </Border>

                <Border Grid.Row="6" Grid.Column="0" Style="{StaticResource PropLabelBorder}" Visibility="{Binding NodeType, Converter={StaticResource ConnectionToVis}, ConverterParameter=Connection}">
                    <TextBlock Text="Connection Ref" Style="{StaticResource PropLabelText}"/>
                </Border>
                <Border Grid.Row="6" Grid.Column="1" Style="{StaticResource PropValueBorder}" Visibility="{Binding NodeType, Converter={StaticResource ConnectionToVis}, ConverterParameter=Connection}">
                    <TextBox Text="{Binding ConnectionRef}" IsReadOnly="True" Style="{StaticResource PropInput}" Background="#FFFFE0"/>
                </Border>
            </Grid>
        </DataTemplate>

        <DataTemplate DataType="{x:Type viewmodels:TrackViewModel}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" SharedSizeGroup="Label"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <!-- Separator -->
                    <RowDefinition Height="Auto"/>
                    <!-- Begin Node Header -->
                    <RowDefinition Height="Auto"/>
                    <!-- Begin Node -->
                    <RowDefinition Height="Auto"/>
                    <!-- End Node Header -->
                    <RowDefinition Height="Auto"/>
                    <!-- End Node -->
                    <RowDefinition Height="Auto"/>
                    <!-- Separator -->
                    <RowDefinition Height="Auto"/>
                    <!-- Length -->
                    <RowDefinition Height="Auto"/>
                    <!-- Checkbox -->
                    <RowDefinition Height="Auto"/>
                    <!-- Coords -->
                </Grid.RowDefinitions>

                <Border Grid.Row="0" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                    <TextBlock Text="ID" Style="{StaticResource PropLabelText}"/>
                </Border>
                <Border Grid.Row="0" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                    <TextBox Text="{Binding Id, Mode=OneWay}" IsReadOnly="True" Style="{StaticResource PropInput}" Foreground="Gray"/>
                </Border>

                <Border Grid.Row="1" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                    <TextBlock Text="Name" Style="{StaticResource PropLabelText}"/>
                </Border>
                <Border Grid.Row="1" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                    <TextBox Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource PropInput}"/>
                </Border>

                <Border Grid.Row="2" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                    <TextBlock Text="Description" Style="{StaticResource PropLabelText}"/>
                </Border>
                <Border Grid.Row="2" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                    <TextBox Text="{Binding Description, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource PropInput}"/>
                </Border>

                <Border Grid.Row="3" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                    <TextBlock Text="Type" Style="{StaticResource PropLabelText}"/>
                </Border>
                <Border Grid.Row="3" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                    <ComboBox ItemsSource="{Binding AvailableTypes}" SelectedItem="{Binding Type, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource PropComboInput}"/>
                </Border>

                <Border Grid.Row="4" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                    <TextBlock Text="MainDir" Style="{StaticResource PropLabelText}"/>
                </Border>
                <Border Grid.Row="4" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                    <ComboBox ItemsSource="{Binding AvailableMainDirs}" SelectedItem="{Binding MainDir, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource PropComboInput}"/>
                </Border>

                <Separator Grid.Row="5" Grid.ColumnSpan="2" Margin="0,5"/>
                <TextBlock Text="Begin Node" Grid.Row="6" Grid.ColumnSpan="2" FontWeight="Bold" Margin="0,5"/>
                <ContentControl Content="{Binding BeginNode}" Grid.Row="7" Grid.ColumnSpan="2"/>

                <TextBlock Text="End Node" Grid.Row="8" Grid.ColumnSpan="2" FontWeight="Bold" Margin="0,5"/>
                <ContentControl Content="{Binding EndNode}" Grid.Row="9" Grid.ColumnSpan="2"/>

                <Separator Grid.Row="10" Grid.ColumnSpan="2" Margin="0,5"/>

                <Border Grid.Row="11" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                    <TextBlock Text="Length" Style="{StaticResource PropLabelText}"/>
                </Border>
                <Border Grid.Row="11" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                    <TextBox Text="{Binding Length, Mode=OneWay, StringFormat=N2}" IsReadOnly="True" Style="{StaticResource PropInput}" Foreground="Gray"/>
                </Border>

                <CheckBox Content="Show Coordinates" IsChecked="{Binding ShowCoordinates}" Grid.Row="12" Grid.ColumnSpan="2" VerticalAlignment="Center" Margin="5,10,0,5"/>

                <StackPanel Grid.Row="13" Grid.ColumnSpan="2" Visibility="{Binding ShowCoordinates, Converter={StaticResource BoolToVis}}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" SharedSizeGroup="Label"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Border Grid.Row="0" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                            <TextBlock Text="Begin X" Style="{StaticResource PropLabelText}"/>
                        </Border>
                        <Border Grid.Row="0" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                            <TextBox Text="{Binding X, UpdateSourceTrigger=PropertyChanged}" IsReadOnly="True" Foreground="Gray" Style="{StaticResource PropInput}"/>
                        </Border>

                        <Border Grid.Row="1" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                            <TextBlock Text="Begin Y" Style="{StaticResource PropLabelText}"/>
                        </Border>
                        <Border Grid.Row="1" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                            <TextBox Text="{Binding Y, UpdateSourceTrigger=PropertyChanged}" IsReadOnly="True" Foreground="Gray" Style="{StaticResource PropInput}"/>
                        </Border>

                        <Border Grid.Row="2" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                            <TextBlock Text="End X" Style="{StaticResource PropLabelText}"/>
                        </Border>
                        <Border Grid.Row="2" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                            <TextBox Text="{Binding X2, UpdateSourceTrigger=PropertyChanged}" IsReadOnly="True" Foreground="Gray" Style="{StaticResource PropInput}"/>
                        </Border>

                        <Border Grid.Row="3" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                            <TextBlock Text="End Y" Style="{StaticResource PropLabelText}"/>
                        </Border>
                        <Border Grid.Row="3" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                            <TextBox Text="{Binding Y2, UpdateSourceTrigger=PropertyChanged}" IsReadOnly="True" Foreground="Gray" Style="{StaticResource PropInput}"/>
                        </Border>
                    </Grid>
                </StackPanel>
            </Grid>
        </DataTemplate>

        <DataTemplate DataType="{x:Type viewmodels:CurvedTrackViewModel}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" SharedSizeGroup="Label"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <Border Grid.Row="0" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                    <TextBlock Text="ID" Style="{StaticResource PropLabelText}"/>
                </Border>
                <Border Grid.Row="0" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                    <TextBox Text="{Binding Id, Mode=OneWay}" IsReadOnly="True" Style="{StaticResource PropInput}" Foreground="Gray"/>
                </Border>

                <Border Grid.Row="1" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                    <TextBlock Text="Name" Style="{StaticResource PropLabelText}"/>
                </Border>
                <Border Grid.Row="1" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                    <TextBox Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource PropInput}"/>
                </Border>

                <Border Grid.Row="2" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                    <TextBlock Text="Description" Style="{StaticResource PropLabelText}"/>
                </Border>
                <Border Grid.Row="2" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                    <TextBox Text="{Binding Description, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource PropInput}"/>
                </Border>

                <Border Grid.Row="3" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                    <TextBlock Text="Type" Style="{StaticResource PropLabelText}"/>
                </Border>
                <Border Grid.Row="3" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                    <ComboBox ItemsSource="{Binding AvailableTypes}" SelectedItem="{Binding Type, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource PropComboInput}"/>
                </Border>

                <Border Grid.Row="4" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                    <TextBlock Text="MainDir" Style="{StaticResource PropLabelText}"/>
                </Border>
                <Border Grid.Row="4" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                    <ComboBox ItemsSource="{Binding AvailableMainDirs}" SelectedItem="{Binding MainDir, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource PropComboInput}"/>
                </Border>

                <Separator Grid.Row="5" Grid.ColumnSpan="2" Margin="0,5"/>
                <TextBlock Text="Begin Node" Grid.Row="6" Grid.ColumnSpan="2" FontWeight="Bold" Margin="0,5"/>
                <ContentControl Content="{Binding BeginNode}" Grid.Row="7" Grid.ColumnSpan="2"/>

                <TextBlock Text="End Node" Grid.Row="8" Grid.ColumnSpan="2" FontWeight="Bold" Margin="0,5"/>
                <ContentControl Content="{Binding EndNode}" Grid.Row="9" Grid.ColumnSpan="2"/>

                <Separator Grid.Row="10" Grid.ColumnSpan="2" Margin="0,5"/>

                <Border Grid.Row="11" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                    <TextBlock Text="Length" Style="{StaticResource PropLabelText}"/>
                </Border>
                <Border Grid.Row="11" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                    <TextBox Text="{Binding Length, Mode=OneWay, StringFormat=N2}" IsReadOnly="True" Style="{StaticResource PropInput}" Foreground="Gray"/>
                </Border>

                <CheckBox Content="Show Coordinates" IsChecked="{Binding ShowCoordinates}" Grid.Row="12" Grid.ColumnSpan="2" VerticalAlignment="Center" Margin="5,10,0,5"/>

                <StackPanel Grid.Row="13" Grid.ColumnSpan="2" Visibility="{Binding ShowCoordinates, Converter={StaticResource BoolToVis}}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" SharedSizeGroup="Label"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Border Grid.Row="0" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                            <TextBlock Text="Begin X" Style="{StaticResource PropLabelText}"/>
                        </Border>
                        <Border Grid.Row="0" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                            <TextBox Text="{Binding X, UpdateSourceTrigger=PropertyChanged}" IsReadOnly="True" Foreground="Gray" Style="{StaticResource PropInput}"/>
                        </Border>

                        <Border Grid.Row="1" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                            <TextBlock Text="Begin Y" Style="{StaticResource PropLabelText}"/>
                        </Border>
                        <Border Grid.Row="1" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                            <TextBox Text="{Binding Y, UpdateSourceTrigger=PropertyChanged}" IsReadOnly="True" Foreground="Gray" Style="{StaticResource PropInput}"/>
                        </Border>

                        <Border Grid.Row="2" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                            <TextBlock Text="Mid X" Style="{StaticResource PropLabelText}"/>
                        </Border>
                        <Border Grid.Row="2" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                            <TextBox Text="{Binding MX, UpdateSourceTrigger=PropertyChanged}" IsReadOnly="True" Foreground="Gray" Style="{StaticResource PropInput}"/>
                        </Border>
                        <Border Grid.Row="3" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                            <TextBlock Text="Mid Y" Style="{StaticResource PropLabelText}"/>
                        </Border>
                        <Border Grid.Row="3" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                            <TextBox Text="{Binding MY, UpdateSourceTrigger=PropertyChanged}" IsReadOnly="True" Foreground="Gray" Style="{StaticResource PropInput}"/>
                        </Border>

                        <Border Grid.Row="4" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                            <TextBlock Text="End X" Style="{StaticResource PropLabelText}"/>
                        </Border>
                        <Border Grid.Row="4" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                            <TextBox Text="{Binding X2, UpdateSourceTrigger=PropertyChanged}" IsReadOnly="True" Foreground="Gray" Style="{StaticResource PropInput}"/>
                        </Border>

                        <Border Grid.Row="5" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                            <TextBlock Text="End Y" Style="{StaticResource PropLabelText}"/>
                        </Border>
                        <Border Grid.Row="5" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                            <TextBox Text="{Binding Y2, UpdateSourceTrigger=PropertyChanged}" IsReadOnly="True" Foreground="Gray" Style="{StaticResource PropInput}"/>
                        </Border>
                    </Grid>
                </StackPanel>
            </Grid>
        </DataTemplate>

        <DataTemplate DataType="{x:Type viewmodels:SwitchViewModel}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" SharedSizeGroup="Label"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <Border Grid.Row="0" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                    <TextBlock Text="ID" Style="{StaticResource PropLabelText}"/>
                </Border>
                <Border Grid.Row="0" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                    <TextBox Text="{Binding Id, Mode=OneWay}" IsReadOnly="True" Style="{StaticResource PropInput}" Foreground="Gray"/>
                </Border>

                <Border Grid.Row="1" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                    <TextBlock Text="Name" Style="{StaticResource PropLabelText}"/>
                </Border>
                <Border Grid.Row="1" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                    <TextBox Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource PropInput}"/>
                </Border>

                <Border Grid.Row="2" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                    <TextBlock Text="Course" Style="{StaticResource PropLabelText}"/>
                </Border>
                <Border Grid.Row="2" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                    <ComboBox ItemsSource="{Binding AvailableCourses}" SelectedItem="{Binding TrackContinueCourse, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource PropComboInput}"/>
                </Border>

                <Border Grid.Row="3" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                    <TextBlock Text="NormalPos" Style="{StaticResource PropLabelText}"/>
                </Border>
                <Border Grid.Row="3" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                    <ComboBox ItemsSource="{Binding AvailableCourses}" SelectedItem="{Binding NormalPosition, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource PropComboInput}"/>
                </Border>

                <Border Grid.Row="4" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                    <TextBlock Text="Diverging" Style="{StaticResource PropLabelText}" VerticalAlignment="Top"/>
                </Border>
                <Border Grid.Row="4" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                    <ItemsControl ItemsSource="{Binding DivergingConnections}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border BorderBrush="#E0E0E0" BorderThickness="0,0,0,1" Margin="0" Padding="0">
                                    <StackPanel>
                                        <Grid Margin="0,0,0,5">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Text="{Binding DisplayName}" FontWeight="Bold" Foreground="#333" VerticalAlignment="Center" Margin="0,0,10,0" FontSize="11"/>
                                            <ComboBox Grid.Column="1" ItemsSource="{Binding AvailableCourses}" SelectedItem="{Binding Course, UpdateSourceTrigger=PropertyChanged}" Width="90" Height="22" FontSize="10"/>
                                        </Grid>
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto" SharedSizeGroup="Label"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                            </Grid.RowDefinitions>

                                            <Border Grid.Row="0" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                                                <TextBlock Text="Conn. ID" Style="{StaticResource PropLabelText}" FontSize="10"/>
                                            </Border>
                                            <Border Grid.Row="0" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                                                <TextBox Text="{Binding Id, Mode=OneWay}" IsReadOnly="True" Style="{StaticResource PropInput}" FontSize="10" Foreground="Gray"/>
                                            </Border>

                                            <Border Grid.Row="1" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                                                <TextBlock Text="Conn. Ref" Style="{StaticResource PropLabelText}" FontSize="10"/>
                                            </Border>
                                            <Border Grid.Row="1" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                                                <TextBox Text="{Binding Ref, Mode=OneWay}" IsReadOnly="True" Style="{StaticResource PropInput}" FontSize="10" Foreground="Gray"/>
                                            </Border>

                                            <Border Grid.Row="2" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                                                <TextBlock Text="Orientation" Style="{StaticResource PropLabelText}" FontSize="10"/>
                                            </Border>
                                            <Border Grid.Row="2" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                                                <TextBox Text="{Binding Orientation, Mode=OneWay}" IsReadOnly="True" Style="{StaticResource PropInput}" FontSize="10" Foreground="Gray"/>
                                            </Border>
                                        </Grid>
                                    </StackPanel>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </Border>

                <CheckBox Content="Show Coordinates" IsChecked="{Binding ShowCoordinates}" Grid.Row="5" Grid.ColumnSpan="2" VerticalAlignment="Center" Margin="0,10,0,5"/>

                <StackPanel Grid.Row="6" Grid.ColumnSpan="2" Visibility="{Binding ShowCoordinates, Converter={StaticResource BoolToVis}}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" SharedSizeGroup="Label"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Border Grid.Row="0" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                            <TextBlock Text="X" Style="{StaticResource PropLabelText}"/>
                        </Border>
                        <Border Grid.Row="0" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                            <TextBox Text="{Binding X, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource PropInput}"/>
                        </Border>

                        <Border Grid.Row="1" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                            <TextBlock Text="Y" Style="{StaticResource PropLabelText}"/>
                        </Border>
                        <Border Grid.Row="1" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                            <TextBox Text="{Binding Y, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource PropInput}"/>
                        </Border>
                    </Grid>
                </StackPanel>
            </Grid>
        </DataTemplate>

        <DataTemplate DataType="{x:Type viewmodels:SignalViewModel}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" SharedSizeGroup="Label"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <Border Grid.Row="0" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                    <TextBlock Text="ID" Style="{StaticResource PropLabelText}"/>
                </Border>
                <Border Grid.Row="0" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                    <TextBox Text="{Binding Id}" IsReadOnly="True" Style="{StaticResource PropInput}" Foreground="Gray"/>
                </Border>

                <Border Grid.Row="1" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                    <TextBlock Text="Name" Style="{StaticResource PropLabelText}"/>
                </Border>
                <Border Grid.Row="1" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                    <TextBox Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource PropInput}"/>
                </Border>

                <Border Grid.Row="2" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                    <TextBlock Text="Type" Style="{StaticResource PropLabelText}"/>
                </Border>
                <Border Grid.Row="2" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                    <ComboBox ItemsSource="{Binding AvailableTypes}" SelectedItem="{Binding Type, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource PropComboInput}"/>
                </Border>

                <Border Grid.Row="3" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                    <TextBlock Text="Function" Style="{StaticResource PropLabelText}"/>
                </Border>
                <Border Grid.Row="3" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                    <ComboBox ItemsSource="{Binding AvailableFunctions}" SelectedItem="{Binding Function, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource PropComboInput}"/>
                </Border>

                <Border Grid.Row="4" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                    <TextBlock Text="Direction" Style="{StaticResource PropLabelText}"/>
                </Border>
                <Border Grid.Row="4" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                    <ComboBox ItemsSource="{Binding AvailableDirections}" SelectedItem="{Binding Direction, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource PropComboInput}"/>
                </Border>

                <Border Grid.Row="5" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                    <TextBlock Text="Track Ref" Style="{StaticResource PropLabelText}"/>
                </Border>
                <Border Grid.Row="5" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                    <TextBox Text="{Binding RelatedTrackId}" IsReadOnly="True" Style="{StaticResource PropInput}" Foreground="Gray"/>
                </Border>

                <Border Grid.Row="6" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                    <TextBlock Text="Pos" Style="{StaticResource PropLabelText}"/>
                </Border>
                <Border Grid.Row="6" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                    <TextBox Text="{Binding Pos, StringFormat=F0, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource PropInput}"/>
                </Border>

                <CheckBox Content="Show Coordinates" IsChecked="{Binding ShowCoordinates}" Grid.Row="7" Grid.ColumnSpan="2" VerticalAlignment="Center" Margin="5,10,0,5"/>

                <StackPanel Grid.Row="8" Grid.ColumnSpan="2" Visibility="{Binding ShowCoordinates, Converter={StaticResource BoolToVis}}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" SharedSizeGroup="Label"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Border Grid.Row="0" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                            <TextBlock Text="X" Style="{StaticResource PropLabelText}"/>
                        </Border>
                        <Border Grid.Row="0" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                            <TextBox Text="{Binding X}" IsReadOnly="True" Foreground="Gray" Style="{StaticResource PropInput}"/>
                        </Border>

                        <Border Grid.Row="1" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                            <TextBlock Text="Y" Style="{StaticResource PropLabelText}"/>
                        </Border>
                        <Border Grid.Row="1" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                            <TextBox Text="{Binding Y}" IsReadOnly="True" Foreground="Gray" Style="{StaticResource PropInput}"/>
                        </Border>
                    </Grid>
                </StackPanel>
            </Grid>
        </DataTemplate>

        <DataTemplate DataType="{x:Type viewmodels:RouteViewModel}">
            <StackPanel>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" SharedSizeGroup="Label"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <Border Grid.Row="0" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                        <TextBlock Text="ID" Style="{StaticResource PropLabelText}"/>
                    </Border>
                    <Border Grid.Row="0" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                        <TextBox Text="{Binding Id}" IsReadOnly="True" Style="{StaticResource PropInput}" Foreground="Gray"/>
                    </Border>

                    <Border Grid.Row="1" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                        <TextBlock Text="Name" Style="{StaticResource PropLabelText}"/>
                    </Border>
                    <Border Grid.Row="1" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                        <TextBox Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource PropInput}"/>
                    </Border>

                    <Border Grid.Row="2" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                        <TextBlock Text="Code" Style="{StaticResource PropLabelText}"/>
                    </Border>
                    <Border Grid.Row="2" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                        <TextBox Text="{Binding Code, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource PropInput}"/>
                    </Border>

                    <Border Grid.Row="3" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                        <TextBlock Text="Description" Style="{StaticResource PropLabelText}"/>
                    </Border>
                    <Border Grid.Row="3" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                        <TextBox Text="{Binding Description, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource PropInput}"/>
                    </Border>

                    <Border Grid.Row="4" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                        <TextBlock Text="ApproachP" Style="{StaticResource PropLabelText}"/>
                    </Border>
                    <Border Grid.Row="4" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                        <TextBox Text="{Binding ApproachPointRef, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource PropInput}"/>
                    </Border>

                    <Border Grid.Row="5" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                        <TextBlock Text="EntrySignal" Style="{StaticResource PropLabelText}"/>
                    </Border>
                    <Border Grid.Row="5" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                        <TextBox Text="{Binding EntryRef, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource PropInput}"/>
                    </Border>

                    <Border Grid.Row="6" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                        <TextBlock Text="ExitSignal" Style="{StaticResource PropLabelText}"/>
                    </Border>
                    <Border Grid.Row="6" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                        <TextBox Text="{Binding ExitRef, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource PropInput}"/>
                    </Border>

                    <Border Grid.Row="7" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                        <TextBlock Text="OverlapEnd" Style="{StaticResource PropLabelText}"/>
                    </Border>
                    <Border Grid.Row="7" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                        <TextBox Text="{Binding OverlapEndRef, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource PropInput}"/>
                    </Border>

                    <Border Grid.Row="8" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                        <TextBlock Text="Speed" Style="{StaticResource PropLabelText}"/>
                    </Border>
                    <Border Grid.Row="8" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                        <ComboBox ItemsSource="{Binding AvailableProceedSpeeds}" SelectedItem="{Binding ProceedSpeed, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource PropComboInput}"/>
                    </Border>

                    <Border Grid.Row="9" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                        <TextBlock Text="RelTriggerH" Style="{StaticResource PropLabelText}"/>
                    </Border>
                    <Border Grid.Row="9" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                        <CheckBox IsChecked="{Binding ReleaseTriggerHead, UpdateSourceTrigger=PropertyChanged}" VerticalAlignment="Center" Margin="5,0"/>
                    </Border>

                    <Border Grid.Row="10" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                        <TextBlock Text="RelTriggerRef" Style="{StaticResource PropLabelText}"/>
                    </Border>
                    <Border Grid.Row="10" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                        <TextBox Text="{Binding ReleaseTriggerRef, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource PropInput}"/>
                    </Border>
                </Grid>

                <Separator Margin="0,5"/>

                <StackPanel Margin="0,5">
                    <Grid Margin="0,0,0,5">
                        <TextBlock Text="Switches" FontWeight="Bold" VerticalAlignment="Center"/>
                        <Button Content="+" Command="{Binding AddSwitchPositionCommand}" HorizontalAlignment="Right" Width="20" Height="20"/>
                    </Grid>
                    <ItemsControl ItemsSource="{Binding SwitchAndPositions}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Grid Margin="0,2">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBox Text="{Binding SwitchRef, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,5,0" Tag="SwitchRef"/>
                                    <ComboBox Grid.Column="1" ItemsSource="{Binding AvailablePositions}" SelectedItem="{Binding SwitchPosition, UpdateSourceTrigger=PropertyChanged}" Width="70" Margin="0,0,5,0"/>
                                    <Button Grid.Column="2" Content="-" Command="{Binding RemoveCommand}" CommandParameter="{Binding}" Width="20" Height="20"/>
                                </Grid>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>

                <Separator Margin="0,5"/>

                <StackPanel Margin="0,5">
                    <Grid Margin="0,0,0,5">
                        <TextBlock Text="OverlapSw" FontWeight="Bold" VerticalAlignment="Center"/>
                        <Button Content="+" Command="{Binding AddOverlapSwitchPositionCommand}" HorizontalAlignment="Right" Width="20" Height="20"/>
                    </Grid>
                    <ItemsControl ItemsSource="{Binding OverlapSwitchAndPositions}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Grid Margin="0,2">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBox Text="{Binding SwitchRef, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,5,0"/>
                                    <ComboBox Grid.Column="1" ItemsSource="{Binding AvailablePositions}" SelectedItem="{Binding SwitchPosition, UpdateSourceTrigger=PropertyChanged}" Width="70" Margin="0,0,5,0"/>
                                    <Button Grid.Column="2" Content="-" Command="{Binding RemoveCommand}" CommandParameter="{Binding}" Width="20" Height="20"/>
                                </Grid>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>

                <Separator Margin="0,5"/>

                <StackPanel Margin="0,5">
                    <Grid Margin="0,0,0,5">
                        <TextBlock Text="Release Sections" FontWeight="Bold" VerticalAlignment="Center"/>
                        <Button Content="+" Command="{Binding AddReleaseSectionCommand}" HorizontalAlignment="Right" Width="20" Height="20"/>
                    </Grid>
                    <ItemsControl ItemsSource="{Binding ReleaseSections}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Grid Margin="0,2">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBox Text="{Binding TrackRef, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,5,0" ToolTip="Track Reference"/>
                                    <ComboBox Grid.Column="1" ItemsSource="{Binding AvailableProtections}" SelectedItem="{Binding FlankProtection, UpdateSourceTrigger=PropertyChanged}" Width="70" Margin="0,0,5,0" ToolTip="Flank Protection"/>
                                    <Button Grid.Column="2" Content="-" Command="{Binding RemoveCommand}" CommandParameter="{Binding}" Width="20" Height="20"/>
                                </Grid>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </StackPanel>
        </DataTemplate>

        <DataTemplate DataType="{x:Type viewmodels:TrackCircuitBorderViewModel}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" SharedSizeGroup="Label"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <Border Grid.Row="0" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                    <TextBlock Text="ID" Style="{StaticResource PropLabelText}"/>
                </Border>
                <Border Grid.Row="0" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                    <TextBox Text="{Binding Id}" IsReadOnly="True" Style="{StaticResource PropInput}" Foreground="Gray"/>
                </Border>

                <Border Grid.Row="1" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                    <TextBlock Text="Name" Style="{StaticResource PropLabelText}"/>
                </Border>
                <Border Grid.Row="1" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                    <TextBox Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource PropInput}"/>
                </Border>

                <Border Grid.Row="2" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                    <TextBlock Text="Code" Style="{StaticResource PropLabelText}"/>
                </Border>
                <Border Grid.Row="2" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                    <TextBox Text="{Binding Code, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource PropInput}"/>
                </Border>

                <Border Grid.Row="3" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                    <TextBlock Text="Description" Style="{StaticResource PropLabelText}"/>
                </Border>
                <Border Grid.Row="3" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                    <TextBox Text="{Binding Description, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource PropInput}"/>
                </Border>

                <Border Grid.Row="4" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                    <TextBlock Text="Pos" Style="{StaticResource PropLabelText}"/>
                </Border>
                <Border Grid.Row="4" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                    <TextBox Text="{Binding Pos, StringFormat=F0, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource PropInput}"/>
                </Border>

                <Border Grid.Row="5" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                    <TextBlock Text="Track Ref" Style="{StaticResource PropLabelText}"/>
                </Border>
                <Border Grid.Row="5" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                    <TextBox Text="{Binding RelatedTrackId}" IsReadOnly="True" Style="{StaticResource PropInput}" Foreground="Gray"/>
                </Border>

                <CheckBox Content="Show Coordinates" IsChecked="{Binding ShowCoordinates}" Grid.Row="6" Grid.ColumnSpan="2" VerticalAlignment="Center" Margin="5,10,0,5"/>

                <StackPanel Grid.Row="7" Grid.ColumnSpan="2" Visibility="{Binding ShowCoordinates, Converter={StaticResource BoolToVis}}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" SharedSizeGroup="Label"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Border Grid.Row="0" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                            <TextBlock Text="X" Style="{StaticResource PropLabelText}"/>
                        </Border>
                        <Border Grid.Row="0" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                            <TextBox Text="{Binding X}" IsReadOnly="True" Foreground="Gray" Style="{StaticResource PropInput}"/>
                        </Border>

                        <Border Grid.Row="1" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                            <TextBlock Text="Y" Style="{StaticResource PropLabelText}"/>
                        </Border>
                        <Border Grid.Row="1" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                            <TextBox Text="{Binding Y}" IsReadOnly="True" Foreground="Gray" Style="{StaticResource PropInput}"/>
                        </Border>
                    </Grid>
                </StackPanel>
            </Grid>
        </DataTemplate>

        <DataTemplate DataType="{x:Type viewmodels:AreaViewModel}">
            <StackPanel>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" SharedSizeGroup="Label"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <Border Grid.Row="0" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                        <TextBlock Text="ID" Style="{StaticResource PropLabelText}"/>
                    </Border>
                    <Border Grid.Row="0" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                        <TextBox Text="{Binding Id}" IsReadOnly="True" Style="{StaticResource PropInput}" Foreground="Gray"/>
                    </Border>

                    <Border Grid.Row="1" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                        <TextBlock Text="Name" Style="{StaticResource PropLabelText}"/>
                    </Border>
                    <Border Grid.Row="1" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                        <TextBox Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource PropInput}"/>
                    </Border>

                    <Border Grid.Row="2" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                        <TextBlock Text="Type" Style="{StaticResource PropLabelText}"/>
                    </Border>
                    <Border Grid.Row="2" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                        <ComboBox ItemsSource="{Binding AvailableTypes}" SelectedItem="{Binding Type, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource PropComboInput}"/>
                    </Border>

                    <Border Grid.Row="3" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                        <TextBlock Text="Description" Style="{StaticResource PropLabelText}"/>
                    </Border>
                    <Border Grid.Row="3" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                        <TextBox Text="{Binding Description, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource PropInput}"/>
                    </Border>
                </Grid>
            </StackPanel>
        </DataTemplate>

        <DataTemplate DataType="{x:Type viewmodels:InfrastructureViewModel}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" SharedSizeGroup="Label"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <Border Grid.Row="0" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                    <TextBlock Text="ID" Style="{StaticResource PropLabelText}"/>
                </Border>
                <Border Grid.Row="0" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                    <TextBox Text="{Binding Id}" IsReadOnly="True" Style="{StaticResource PropInput}" Foreground="Gray"/>
                </Border>

                <Border Grid.Row="1" Grid.Column="0" Style="{StaticResource PropLabelBorder}">
                    <TextBlock Text="Name" Style="{StaticResource PropLabelText}"/>
                </Border>
                <Border Grid.Row="1" Grid.Column="1" Style="{StaticResource PropValueBorder}">
                    <TextBox Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource PropInput}"/>
                </Border>
            </Grid>
        </DataTemplate>

    </UserControl.Resources>

    <DockPanel>
        <TextBlock Text="Properties" DockPanel.Dock="Top" Background="#F0F0F0" Padding="5" FontWeight="Bold"/>
        <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto" RequestBringIntoView="Properties_RequestBringIntoView">
            <ContentControl Content="{Binding SelectedElement}" IsTabStop="False"/>
        </ScrollViewer>
    </DockPanel>
</UserControl>
